<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Filter</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Data Filter</h1>

    <select id="column-select">
        <!-- Options will be populated dynamically -->
    </select>

    <div id="value-select-container" style="display: none;">
        <select id="value-select">
            <!-- Options will be populated dynamically for Player and Character -->
        </select>
    </div>

    <div id="search-container">
        <input type="text" id="search-input" placeholder="Search...">
    </div>

    <button id="filter-button">Filter</button>

    <div id="results"></div>

    <script>
    $(document).ready(function() {
        // Populate dropdown with column names
        $.getJSON('/get_columns', function(data) {
            var select = $('#column-select');
            $.each(data, function(index, value) {
                select.append($('<option></option>').attr('value', value).text(value));
            });
        });

        // Handle column selection change
        $('#column-select').change(function() {
            var column = $(this).val();
            if (['Player', 'Character', 'Tournament'].includes(column)) {
                $('#search-container').hide();
                $('#value-select-container').show();
                populateValueSelect(column);
            } else {
                $('#search-container').show();
                $('#value-select-container').hide();
            }
        });

        // Populate value select for Player, Character, and Tournament
        function populateValueSelect(column) {
            $.getJSON('/get_unique_values', {column: column}, function(data) {
                var select = $('#value-select');
                select.empty();
                $.each(data, function(index, value) {
                    select.append($('<option></option>').attr('value', value).text(value));
                });
            });
        }

        // Handle filter button click
        $('#filter-button').click(function() {
            var column = $('#column-select').val();
            var value;
            if (['Player', 'Character', 'Tournament'].includes(column)) {
                value = $('#value-select').val();
            } else {
                value = $('#search-input').val();
            }

            $.getJSON('/filter', {column: column, value: value}, function(data) {
                $('#results').html(data.html);
            });
        });
    });
</script>
</body>
</html>